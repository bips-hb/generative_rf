---
title: "SDV Benchmark"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(reticulate)
source("generative_ranger.R")
```

```{python, include=FALSE}
import numpy as np
from sdv.tabular import GaussianCopula
import sdgym
from sdgym.synthesizers import Independent
from sdgym.synthesizers import Identity
```

```{r, include=FALSE}
my_generative_ranger <- function(x) {
  x_r <- py_to_r(x)
  
  # Chars and logicals to factors
  idx <- sapply(x_r, is.character)
  x_r[idx] <- as.data.frame(lapply(x_r[idx], as.factor))
  idx <- sapply(x_r, is.logical)
  x_r[idx] <- as.data.frame(lapply(x_r[idx], as.factor))
  
  # Run generative RF
  res <- generative_ranger(x_real = x_r, x_synth = NULL, n_new = nrow(x_r),
                           num.trees = 10, min.node.size = 50)
  
  # Convert logicals back
  if (any(idx)) {
    res[idx] <- as.data.frame(lapply(res[idx], function(x) {x == "TRUE"}))
  }
  
  # Return synthetic data
  colnames(res) <- colnames(x_r)
  res
}
```

# Run benchmark in python
```{python}
def gen_rf(real_data, metadata):
    table_name = metadata.get_tables()[0]
    return {table_name: r.my_generative_ranger(real_data[table_name])}

synthesizers = [gen_rf, Identity] # Identity should return original data as synthetic data
scores = sdgym.run(synthesizers=synthesizers, datasets=['adult', 'census', 'intrusion', 'news'])
```

# Show results from python
```{python}
#pd.set_option('display.max_columns', 20) 
scores
```
# Show results from R
```{r}
py$scores
```



